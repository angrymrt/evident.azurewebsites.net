/*!*
----------------------------------
jquery.colorMatrix.js
----------------------------------
version:        1.0
last update:    Januari 9th, 2015
author:         Maarten Zilverberg
tested:         Webkit, FF31+, IE8+
----------------------------------
**/
define(["jquery"], function (jQuery) {

(function(f,d,a,h){var e="colorMatrix",c={svg:"http://www.w3.org/2000/svg",xlink:"http://www.w3.org/1999/xlink"},g={className:"grayscale",type:"saturate",ids:["desaturate","normal"],values:[0,1]};function b(j,i){this.element=j;this.settings=f.extend({},g,i);this._defaults=g;this._name=e;this.init()}f.extend(b.prototype,{cssFiltersSupported:function(){var m=a.createElement("div"),n=" -webkit- -moz- -o- -ms- ".split(" ");m.style.cssText=n.join("filter: blur(2px); ");var l=f(this.element).addClass(this.settings.className).css("filter"),j=!!m.style.length||l!=="none",i=(a.documentMode===h||a.documentMode>9),k=j&&i;return k},svgSupported:function(){var i=a.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#Image","1.1");return true},isOldIE:function(){return a.documentMode<=9},checkImage:function(){var k=this,j=0;function i(){j++;if(k.completeImage()){return true}else{if(j<=100){d.setTimeout(i,100)}else{return true}}}return i()},completeImage:function(){var i=this.element;if(!i.complete){return false}if(typeof i.naturalWidth!=="undefined"&&i.naturalWidth===0){return false}return true},createSVG:function(k,i,l){var j=a.createElementNS(c.svg,"svg");j.setAttribute("width",i);j.setAttribute("height",l);$svg=f(j);this.createSVGDefinitions($svg,k);this.addImage($svg,k,i,l);return $svg},createSVGDefinitions:function(n,l){var j=a.createElementNS(c.svg,"defs");for(var m=0;m<2;m++){var o=a.createElementNS(c.svg,"filter");o.setAttribute("id",this.settings.ids[m]);var k=a.createElementNS(c.svg,"feColorMatrix");k.setAttribute("type",this.settings.type);k.setAttribute("values",this.settings.values[m]);o.appendChild(k);j.appendChild(o)}n[0].appendChild(j)},addImage:function(i,j,o,l){var q={id:j,"class":this.settings.className,width:o,height:l,x:0,y:0,href:[this.element.src,c.xlink],visibility:"visible"};function m(r){return Object.prototype.toString.call(r)==="[object Array]"}var k=a.createElementNS(c.svg,"image");for(var p in q){if(q.hasOwnProperty(p)){var n={namespace:!m(q[p])?null:q[p][1],value:(!m(q[p])?q[p]:q[p][0])};k.setAttributeNS(n.namespace,p,n.value)}}i.append(k)},apply:function(){var k=this.element,i=k.width,l=k.height,j="img_"+Math.random().toString(36).substr(2,9);if(this.cssFiltersSupported()||this.isOldIE()){return;f(k).addClass(this.settings.className);return}if(!this.svgSupported()){throw e+".js: SVG is not supported by this browser";return}$svg=this.createSVG(j,i,l);f(k).hide().after($svg)},init:function(){if(this.checkImage(this.element)){this.apply()}}});f.fn[e]=function(i){this.each(function(){if(!f.data(this,"plugin_"+e)){f.data(this,"plugin_"+e,new b(this,i))}});return this};f(d).on("load",function(){f("."+g.className)[e]()})})(jQuery,window,document);

});